# 2.前端基本防护

**前言：web安全很重要，因为浏览器能做的事情越来越多了，而传统的攻击手段因为经过了很长的时间，所以黑客们也就越来越难攻克，但是黑客如果可以通过网站，攻克你的浏览器，也就能获取到你的root权限，然后控制你的整个电脑，所以web安全很重要，我这里讲到是比较浅的网站级别防护**

## 🍏第一种：SQL注入

### 1.SQL注入基础防护

在服务端进行防范的，很多服务器的框架都已经防范的很好了

例如前端可以向后端提交表单数据，这个非常的常见，但是如果用户恶意的在表单中填写sql代码，例如

```js

';select * from 某某表'

后台一般都是拼接字符串，进行数据库的执行，遇到上面的这个，代码一拼接，遇到 ';' ，就会执行后面的，这就很危险了，也就是说用户可以恶意的删除你的数据库

现在一般的框架都有转义的功能，将敏感的语句进行转义，防止对服务器进行伤害，这个问题一般都不算是大的问题了，服务器都会进行防护的

```

---

## 🍐第二种：XSS

**如果了解前端和后端是如何做的，你就能很清晰的看到XSS的产生原因了**

### 1.XSS简介

XSS（跨站脚本攻击 Cross-Site Script）是一种通过往网页里注入恶意脚本代码，然后用户访问到网页，肯定也就把恶意脚本代码下载下来了，这时候黑客通过恶意脚本，获取和控制用户的信息

根据上面的意思，我们可以感觉到 XSS 是一种注入性攻击手段，而根据注入的不同，我们可以细分为 三种，分别是

- 反射型（非持久性型）XSS
- 存储型（持久型）XSS
- DOM-Based型 XSS

---

### 2.反射性（非持久型）XSS

诱导用户点击恶意链接来造成一次性攻击（原理是在链接上执行JS代码）

```js
// 示例
https://xxx.xxx/<script>alert(1)</script>
```

**❣️ 产生原因： 服务器直接获取请求参数，并直接使用，这个是导致产生这个的主要原因，和SQL注入很类似**

**🔥 防范：对敏感词汇进行转义**

---

### 3.存储型（持久型）XSS

将恶意代码存储到漏洞服务器中，用户浏览相关页面时候就会被攻击（恶意代码执行）

经常发生在评论这种场景下

```js
// 例如注入 console.log(document.cookie)
```

**❣️ 产生原因：还是服务器端没有处理用户提交的信息，就直接使用，导致产生了问题**

**🔥 防范：对用户提交的内容，敏感部分进行转义**

---

### 4.DOM-Based型 XSS

基于浏览器 DOM解析的 攻击方式（不需要后端参与）

常见的触发场景：需要 innerHtml ,outHtml, document.write 改变的时候，可能会受到 DOM-Based型 XSS 攻击

一般可以查看JS代码，看看有没有使用 innerHTML 等等方法，来看是否可以进行攻击

```js

// 一种攻击代码: 借助 img标签，不写 src 报错的机制，执行 onerror 事件中的代码，从而发动XSS攻击
<img src="" onerror="插入代码"></img>

```

---

### 5.XSS payload 和 危害

XSS的攻击方式有很多种，能发起XSS攻击的，我们称之为 XSS payload

XSS payload 的危害有

- 获取cookie
- 获取其他信息
- 伪造请求
- XSS 钓鱼（XSS + 钓鱼网站）

---

### 6.XSS防御 - httpOnly

给 cookie 设置 httpOnly ，可以防止客户端脚本获取cookie

```js
document.cookie // '' 如果设置了，就会拿不到
```

缺点就是：自己也不能获取cookie了，不能从根本上解决XSS

**❣️ 服务端如何设置：只需要在返回头中设置 Set-Cookie: 正常的cookie键值对;httponly**

---

### 7.XSS防御 - 输入检查

原则：永远不相信用户的输入

- 前端：某些场景，做输入格式判断（白名单）和 进行转义（黑名单）
- 后端：转义敏感词汇

**前端和后端都要进行 输入检查**

---

### 8.XSS防御 - 输出检查

根据不同的场景对数据进行处理

根据输出场景不同进行分类

- HTML标签中（HTML执行环境）
- HTML属性中（HTML执行环境）
- script标签中（JS解析环境）
- 事件属性中（JS解析环境）
- URL中（URL解析环境）

```js

// 转义HTML特殊字符
function HtmlEncode(str) {
    var hex = new Array('0','1','2','3','4','5','6','7','8','9','a','b','c','d','e','f');
    var preescape = str;
    var escaped = "";
    for(var i = 0; i < preescape.length; i++){
        var p = preescape.charAt(i);
        escaped = escaped + escapeCharx(p);
    }
    
    return escaped;
                    
    function escapeCharx(original){
        var found=true;
        var thechar=original.charCodeAt(0);
        switch(thechar) {
            case 10: return "<br/>"; break; //newline
            case 32: return "&nbsp;"; break; //space
            case 34:return "&quot;"; break; //"
            case 38:return "&amp;"; break; //&
            case 39:return "&#x27;"; break; //'
            case 47:return "&#x2F;"; break; // /
            case 60:return "&lt;"; break; //<
            case 62:return "&gt;"; break; //>
            case 198:return "&AElig;"; break;
            case 193:return "&Aacute;"; break;
            case 194:return "&Acirc;"; break; 
            case 192:return "&Agrave;"; break; 
            case 197:return "&Aring;"; break; 
            case 195:return "&Atilde;"; break; 
            case 196:return "&Auml;"; break; 
            case 199:return "&Ccedil;"; break; 
            case 208:return "&ETH;"; break;
            case 201:return "&Eacute;"; break; 
            case 202:return "&Ecirc;"; break; 
            case 200:return "&Egrave;"; break; 
            case 203:return "&Euml;"; break;
            case 205:return "&Iacute;"; break;
            case 206:return "&Icirc;"; break; 
            case 204:return "&Igrave;"; break; 
            case 207:return "&Iuml;"; break;
            case 209:return "&Ntilde;"; break; 
            case 211:return "&Oacute;"; break;
            case 212:return "&Ocirc;"; break; 
            case 210:return "&Ograve;"; break; 
            case 216:return "&Oslash;"; break; 
            case 213:return "&Otilde;"; break; 
            case 214:return "&Ouml;"; break;
            case 222:return "&THORN;"; break; 
            case 218:return "&Uacute;"; break; 
            case 219:return "&Ucirc;"; break; 
            case 217:return "&Ugrave;"; break; 
            case 220:return "&Uuml;"; break; 
            case 221:return "&Yacute;"; break;
            case 225:return "&aacute;"; break; 
            case 226:return "&acirc;"; break; 
            case 230:return "&aelig;"; break; 
            case 224:return "&agrave;"; break; 
            case 229:return "&aring;"; break; 
            case 227:return "&atilde;"; break; 
            case 228:return "&auml;"; break; 
            case 231:return "&ccedil;"; break; 
            case 233:return "&eacute;"; break;
            case 234:return "&ecirc;"; break; 
            case 232:return "&egrave;"; break; 
            case 240:return "&eth;"; break; 
            case 235:return "&euml;"; break; 
            case 237:return "&iacute;"; break; 
            case 238:return "&icirc;"; break; 
            case 236:return "&igrave;"; break; 
            case 239:return "&iuml;"; break; 
            case 241:return "&ntilde;"; break; 
            case 243:return "&oacute;"; break;
            case 244:return "&ocirc;"; break; 
            case 242:return "&ograve;"; break; 
            case 248:return "&oslash;"; break; 
            case 245:return "&otilde;"; break;
            case 246:return "&ouml;"; break; 
            case 223:return "&szlig;"; break; 
            case 254:return "&thorn;"; break; 
            case 250:return "&uacute;"; break; 
            case 251:return "&ucirc;"; break; 
            case 249:return "&ugrave;"; break; 
            case 252:return "&uuml;"; break; 
            case 253:return "&yacute;"; break; 
            case 255:return "&yuml;"; break;
            case 162:return "&cent;"; break; 
            case '\r': break;
            default:
                found=false;
                break;
        }
        if(!found){
            if(thechar>127) {
                var c=thechar;
                var a4=c%16;
                c=Math.floor(c/16); 
                var a3=c%16;
                c=Math.floor(c/16);
                var a2=c%16;
                c=Math.floor(c/16);
                var a1=c%16;
                return "&#x"+hex[a1]+hex[a2]+hex[a3]+hex[a4]+";";        
            }
            else{
                return original;
            }
        }    
    }
}

// 转义JS特殊字符
function JavaScriptEncode(str) 
     
    var hex=new Array('0','1','2','3','4','5','6','7','8','9','a','b','c','d','e','f');
        
    function changeTo16Hex(charCode){
        return "\\x" + charCode.charCodeAt(0).toString(16);
    }
    
    function encodeCharx(original) {
        
        var found = true;
        var thecharchar = original.charAt(0);
        var thechar = original.charCodeAt(0);
        switch(thecharchar) {
            case '\n': return "\\n"; break; //newline
            case '\r': return "\\r"; break; //Carriage return
            case '\'': return "\\'"; break;
            case '"': return "\\\""; break;
            case '\&': return "\\&"; break;
            case '\\': return "\\\\"; break;
            case '\t': return "\\t"; break;
            case '\b': return "\\b"; break;
            case '\f': return "\\f"; break;
            case '/': return "\\x2F"; break;
            case '<': return "\\x3C"; break;
            case '>': return "\\x3E"; break;
            default:
                found=false;
                break;
        }
        if(!found){
            if(thechar > 47 && thechar < 58){ //数字
                return original;
            }
            
            if(thechar > 64 && thechar < 91){ //大写字母
                return original;
            }

            if(thechar > 96 && thechar < 123){ //小写字母
                return original;
            }        
            
            if(thechar>127) { //大于127用unicode
                var c = thechar;
                var a4 = c%16;
                c = Math.floor(c/16); 
                var a3 = c%16;
                c = Math.floor(c/16);
                var a2 = c%16;
                c = Math.floor(c/16);
                var a1 = c%16;
                return "\\u"+hex[a1]+hex[a2]+hex[a3]+hex[a4]+"";        
            }
            else {
                return changeTo16Hex(original);
            }
            
        }
    }     
  
    var preescape = str;
    var escaped = "";
    var i=0;
    for(i=0; i < preescape.length; i++){
        escaped = escaped + encodeCharx(preescape.charAt(i));
    }
    return escaped;
}

```

---

### 9.XSS自动化封装层防护

探索中...

---

## 🍊第三种：CSRF

---

## 🍈第四种：DDOS

---

## 🌶第五种：HTTP劫持
