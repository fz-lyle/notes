# 3.微信小程序

## 一.小程序的基础知识与新特性

---

### 1.小程序的4种文件类型

- .wxml：骨架
- .wxss：样式
- .js：业务逻辑
- .json：配置

---

### 2.小程序的组织结构

<img src="https://itzkp-1253302184.cos.ap-beijing.myqcloud.com/notes/2.notes/6.%E7%A7%BB%E5%8A%A8%E7%AB%AF/%E5%B0%8F%E7%A8%8B%E5%BA%8F/1.%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%9A%84%E7%BB%84%E7%BB%87%E7%BB%93%E6%9E%84-1.png" />


---

### 3. app.json配置之导航栏


```
```

---

### 4.wxml与组件

- 小程序毕竟是微信的一个生态内容，所以只能用它所提供的组件，来搭建内容，而不能使用传统的HTML，但是大致的使用基本一致，就是切记这里不是HTML标签，而是组件，后期我们也能通过这个来拼接自己的组件

---

## 二.初识小程序组件

---

### 1.制作一个自定义组件

**定义组件：建立一个新的文件夹components 用来放组件，然后建立一个 like 文件夹，然后使用微信开发者工具快速生成目录**

**引用组件：在需要引入的页面的 .json文件中设置名称**

```json
{
  "usingComponents": {
    "z-like": "/components/like/index"
  }
}
```

**使用组件**

```html
<z-like></z-like>
<z-like></z-like>
<z-like></z-like>
```

---

**❣️ 绝对路径和相对路径**

```js
// /xxx 表示绝对路径，从根目录开始
// ../xxx 这种是相对路径，这个懂

```

---

### 2.like组件样式书写


**小程序尺寸单位和设计原则：rpx 可以自适应，px也有特定的使用场景**

**小程序的CSS选择器比文当中的多**

**🔥给所有页面都设置样式（相当于设置全局样式）**

```css
page {
  /* 苹果平方字体，细体，IOS默认字体，安卓默认是思源字体 */
  font-family: "PingFangSC-Thin";
}

/* ❣️：只有少量可以这样设置，生效的只有 font color */
```

**样式书写**

```html
<view class="container">
  <image src="./images/like.png"></image>
  <text>9</text>
</view>
```

```css
.container {
  /* 设置了flex，那么子元素是具有块级特性的，所以用 inline-flex 这样就具有行内块的特性了，子元素也就宽度自适应了 */
  display: inline-flex;
  flex-direction: row;
  padding: 10rpx;
}

.container image{
  width: 32rpx;
  height: 28rpx;
}

.container text {
  font-size: 24rpx;
  /* 组件最好不要有空白间距 */
  line-height: 24rpx;
  color: #bbb;
  position: relative;
  bottom: 10rpx;
  left: 6rpx;
}
```


---

### 3.组件的数据，事件，与属性

**数据绑定：和插值表达式基本一致,是写到js文件中的 data属性里面的**

- 同样可以应用在标签的属性中，而且不用像 Vue 一样加上 : ，不知道有没有 计算属性的写法，如下

```html
<view bindtap="onLike" class="container">
  <image src="{{like?yesSrc:noSrc}}"></image>
  <text>{{ count }}</text>
</view>

```

---

**组件的properties属性**

- 例如 like 组件的点赞数量，和 点赞的状态 是开放出来的，可以设置的，这个就需要用到 properties 来设置

```js
Component({
  /**
   * 组件的属性列表
   */
  properties: {
    like: {
      type: Boolean // 默认值是false,所以不用写默认值
      // value: false
    },
    count: {
      type: Number // 默认值是0
    }
  }

  // ...
})

// ❣️ 属性里面的内容，也能被插值表达式读取到，即使 data 中没有设置
```

---

```js
Component({
  /**
   * 组件的方法列表
   */
  methods: {

    // 点赞事件
    onLike: function (e) {

      let like = this.properties.like
      let count = this.properties.count

      like = !like
      like ? count+=1 : count-=1

      // 这里就不一样了，不是双向数据绑定，需要手动的通过 setData 来改变
      this.setData({
        like,
        count
      })

    }

  }
  // ...
})
```

---

## 三.访问API数据与ES6在小程序中的应用

### 1.生命周期函数

- 我们一般在 onLoad 生命周期中拿取数据，有点像 Vue的 mounted

---

### 2.wx.request

```js
  /**
   * 生命周期函数--监听页面加载
   */
  onLoad: function (options) {

    // 获取最新一期的期刊
    wx.request({
      url: 'http://bl.7yue.pro/v1/classic/latest?appkey=EOYWLaUkKhvCc5Le',
      success: function (res) {
        console.log(res)
      }
    })

  },

```

---

**封装（utils/http.js）**

```js
// 提示信息
const tips = {
 1005: '秘钥不正确，请现申请',
 1007: '访问的地址不存在',
 3000: '期刊不存在'
}

const _showError = code => {
  return tips[code] || '其他默认错误'
}

export const zhuRequest = params => {

  return new Promise( (resovle, reject) => {

    wx.request({
      url: `http://bl.7yue.pro/v1${params.url}?appkey=EOYWLaUkKhvCc5Le`,
      method: params.method || 'GET',
      
      success(res) {

        let code = res.statusCode.toString()
        
        if (code.startsWith('2')) {
          resovle(res)
        } else {
          wx.showToast({
            title: _showError(res.data.error_code),
            icon: 'none'
          })
          reject(res)
        }

      },

      fail(rej) {
        reject(rej)
      }

    })

  })

}

```

---

**抽离出api层（/api/classic.js）**

```js
import { zhuRequest } from '../utils/http.js'

// 获取最新期刊
export const getNews = () => {
  return zhuRequest({
    url: '/classic/latest'
  })
}
```

---

**使用**


```js
import { getNews } from '../../api/classic.js'

Page({
  /**
   * 生命周期函数--监听页面加载
   */
  onLoad: async function (options) {
    
    // 获取所有期刊数据
    let resData = await getNews()
    console.log('数据：', resData)

  }

})

```

---

### 3.组件属性赋值与页面渲染

```js
import { getNews } from '../../api/classic.js'

Page({
  /**
   * 生命周期函数--监听页面加载
   */
  onLoad: async function (options) {
    
    // 获取所有期刊数据
    let resData = await getNews()

    this.setData({
      classicData: resData.data
    })
  
  }

})
```

```html
<!-- 使用 -->
<z-like count="{{classicData.fav_nums}}" like="{{classicData.like_status}}"></z-like>
```
